DrupalAjaxForm=function(e){var i=this;this.formContainer=e.formContainerId;this.formURL=e.formURL;this.loginRequired=e.loginRequired;this.isFieldDescriptionInline=e.isFieldDescriptionInline===undefined?false:e.isFieldDescriptionInline;this.isErrorInline=e.isErrorInline===undefined?false:e.isErrorInline;this.formFunction=e.formFunction;this.formsuccess=e.formsuccess;this.formerror=e.formerror;this.errorpopup=e.errorpopup;this.error={};this.preSubmit=e.preSubmit?e.preSubmit:false;this.multipart=e.multipart===undefined?false:e.multipart;this.loadingFunction=e.loadingFunction;this.isAjaxForm=e.isAjaxForm===undefined?true:e.isAjaxForm;this.formId=e.formId;var t=function(e,r,n){var o=Drupal.settings.username;if(n&&o||!n){if(i.multipart&&e["type"]=="POST"){return $.ajax({dataType:e["dataType"]?e["dataType"]:"JSON",url:e["url"],type:e["type"]?e["type"]:"GET",data:e["data"],retryCount:e["retryCount"]?e["retryCount"]:0,retryLimit:5,processData:false,contentType:false,success:function(i){if(typeof e["success"]=="function"){e["success"](i)}},error:function(i){if(i.status>=499&&this.retryCount<this.retryLimit){e["retryCount"]=e["retryCount"]?e["retryCount"]+1:1;setTimeout(function(){t(e,r,n)},2e3)}else{if(typeof e["error"]=="function"){e["error"](i)}}}})}else{return $.ajax({dataType:e["dataType"]?e["dataType"]:"JSON",url:e["url"],type:e["type"]?e["type"]:"GET",data:e["data"],retryCount:e["retryCount"]?e["retryCount"]:0,retryLimit:5,success:function(i){if(typeof e["success"]=="function"){e["success"](i)}},error:function(i){if(i.status>=499&&this.retryCount<this.retryLimit){e["retryCount"]=e["retryCount"]?e["retryCount"]+1:1;setTimeout(function(){t(e,r,n)},2e3)}else{if(typeof e["error"]=="function"){e["error"](i)}}}})}}};this.isError=function(){var e=false;$.each(i.error,function(i,t){e=e||t});return e};this.getFormElement=function(){return $($("#"+i.formContainer).find('[cc-forms="form"]')[0])};this.getFormErrorsElement=function(e){if(!i.isErrorInline){var t=$($("#"+i.formContainer).find('[cc-forms="form-errors"]')[0])}else{var t=$($("#"+i.formContainer).find("#edit-"+e).parent().find('[cc-forms="form-field-description"]')[0])}return t};this.getFormDescriptionElement=function(){return $($("#"+i.formContainer).find('[cc-forms="form-description"]')[0])};this.getFormOverlay=function(){return $($("#"+i.formContainer).find('[cc-forms="form-overlay"]')[0])};this.getFormFieldDescriptionElement=function(e){if(!i.isFieldDescriptionInline){var t=$($("#"+i.formContainer).find('[cc-forms="form-field-description"]')[0])}else{var r=$("#"+i.formContainer).find("#edit-"+e).parent().find('[cc-forms="form-field-description"]');if(r.length==1){return $(r[0])}}return t};this.cAjax=t;this.loadForm=function(){this.cAjax({url:i.formURL,error:i.errorP,success:i.successP},true,false,false)};this.bindSubmitFormEvent=function(){i.getFormElement().find("#edit-submit-button").removeClass("form-submit");i.getFormElement().find("#edit-submit-button").click(function(e){if(e!=undefined){e.preventDefault()}i.setLoadingState("loading");i.getFormErrorsElement().fadeOut(0);if(typeof i.preSubmit=="function"){i.preSubmit()}i.cAjax({url:i.formURL,type:"POST",data:i.multipart?new FormData($("#"+i.formId)[0]):$("#"+i.formId).serialize(),error:i.errorP,success:i.successP},true,i.loginRequired)})};this.disableCopyPaste=function(){i.getFormElement().find("input.disablecopypaste").bind("copy paste",function(e){e.preventDefault()})};this.disableAutocomplete=function(){i.getFormElement().find("input").attr("autocomplete","off")};this.showDescription=function(e){var t="";var r="";if(e==i.currentDescription){return}if(!i.isFieldDescriptionInline){t=i.getFormFieldDescriptionElement();if(t){t.find("div").fadeOut(0);t.html('<div style="display: none;"></div>');r=$("#"+e+"-description").html();if(r!=""){t.find("div").html(r);t.find("div").fadeIn(0)}}}else{i.getFormElement().find('[cc-forms="form-field-description"]').fadeOut(0).removeClass("error");t=i.getFormFieldDescriptionElement(e);r=$("#"+e+"-description").html();if(r!=""){t.find('[cc-forms="description"]').html(r);t.fadeIn(0)}}i.currentDescription=e};this.showErrors=function(e){if(typeof e==="string"){i.getFormElement().html(e)}else{if(!i.isErrorInline){i.getFormErrorsElement().find("div").find("ul").html("");var t=i.getFormErrorsElement().find("div").find("ul");$.each(e,function(e,r){e=e.replace(/_/g,"-");i.getFormElement().find("#edit-"+e+"-wrapper").append('<div class="ccl-su-val-message"><img class="ccl-su-val-img" src="/sites/all/modules/codechef_open_register/images/cross-2.svg"></div>');t.append("<li>"+r+"</li>")});i.getFormErrorsElement().fadeIn(0)}else{i.getFormElement().find('[cc-forms="form-field-description"]').fadeOut(0).removeClass("error");$.each(e,function(e,t){e=e.replace(/_/g,"-");var r=i.getFormFieldDescriptionElement(e);if(r){r.find('[cc-forms="description"]').html(t);r.addClass("error");r.fadeIn(0)}})}}i.currentDescription=""};this.setLoadingState=function(e){i.loadingState=e;if(e=="loading"){i.getFormOverlay().fadeIn(0)}else{i.getFormOverlay().fadeOut(0)}if(typeof i.loadingFunction==="function"){i.loadingFunction(e)}};this.attachDescriptionElement=function(){i.getFormElement().find("#"+i.formId).find('[description="1"][type="text"]').parent().append('<div style="display:none;" cc-forms="form-field-description" class="ccl-su-help-position">'+'<div class="ccl-su-help">'+'<div class="ccl-font-s ccl-align-l">'+'<div cc-forms="description"></div></div></div></div>');i.getFormElement().find("#"+i.formId).find('[description="1"][type="password"]').parent().append('<div style="display:none;" cc-forms="form-field-description" class="ccl-su-help-position">'+'<div class="ccl-su-help">'+'<div class="ccl-font-s ccl-align-l">'+'<div cc-forms="description"></div></div></div></div>');i.getFormElement().find("#"+i.formId).find('[description="1"][type="file"]').parent().append('<div style="display:none;" cc-forms="form-field-description" class="ccl-su-help-position">'+'<div class="ccl-su-help">'+'<div class="ccl-font-s ccl-align-l">'+'<div cc-forms="description"></div></div></div></div>');i.getFormElement().find("#"+i.formId).find('[description="1"][type="checkbox"]').parent().append('<div style="display:none;" cc-forms="form-field-description" class="ccl-su-help-position">'+'<div class="ccl-su-help">'+'<div class="ccl-font-s ccl-align-l">'+'<div cc-forms="description"></div></div></div></div>');i.getFormElement().find("#"+i.formId).find('select[description="1"]').parent().append('<div style="display:none;" cc-forms="form-field-description" class="ccl-su-help-position">'+'<div class="ccl-su-help">'+'<div class="ccl-font-s ccl-align-l">'+'<div cc-forms="description"></div></div></div></div>');i.getFormElement().find("#"+i.formId).find('div[description="1"][type="radios"]').parent().append('<div style="display:none;" cc-forms="form-field-description" class="ccl-su-help-position">'+'<div class="ccl-su-help">'+'<div class="ccl-font-s ccl-align-l">'+'<div cc-forms="description"></div></div></div></div>');i.getFormElement().find("#"+i.formId).find('[description="1"]').focus(function(){i.showDescription($(this).attr("name").replace(/_/g,"-"));$(this).removeClass("error");$(this).removeClass("correct")})};this.bindValidators=function(){i.getFormElement().find("#"+i.formId).find('[validate="1"]').focusout(function(e){var t=$(this);if(t.val()){var r=$(this).attr("name");var n=$(this).attr("type");var o=$(i.getFormElement().find("#"+i.formId)[0]);var s=function(e){if(n=="radio"){t.parent().parent().parent().find('[type="radio"]').removeClass("error").removeClass("correct")}else{t.removeClass("success").removeClass("error")}if(e.status==="success"){i.error[r]=false;t.removeClass("error").addClass("correct")}else{i.error[r]=true;t.removeClass("success").addClass("error");i.showErrors(e.errors)}};i.cAjax({url:i.formURL+"?validate="+r,data:o.serialize(),type:"POST",success:s,error:i.errorP})}})};this.alignRadioButtons=function(){var e=i.getFormElement().find(".form-radios");$.each(e,function(e,i){var t=$(i);var r=t.find("div").find("label").find("input").attr("name").replace(/_/g,"-");var n=t.find("div").find("label").find("input").attr("description");t.parent().append("<div description='"+n+"' type='radios' identifier='"+r+"' id='edit-"+r+"'></div>");t.find("div").css("display","inline");t.find("div").find("label")})};this.successP=function(e){i.formId=e.formId;if(!e.form&&e.status=="success"){if(e.timeout===0&&e.redirect){window.location=e.redirect;return}if(typeof i.formsuccess=="function"){i.formsuccess(e)}else{i.getFormElement().html('<div class="ccl-font-p ccl-align-c">'+e.success+"</div>")}}if(e.form){i.getFormElement().html(e.form);i.changeCaptchaHTML();if(typeof i.formFunction=="function"){i.formFunction(i)}i.disableCopyPaste();i.alignRadioButtons();i.attachDescriptionElement();i.bindValidators();i.bindSubmitFormEvent();i.disableAutocomplete()}if(e.status=="error"){i.showErrors(e.errors);if(typeof i.formerror=="function"){i.formerror(e)}}if(e.redirect){if(e.timeout===undefined){setTimeout(function(){window.location=e.redirect},3e3)}else{if(e.timeout){setTimeout(function(){window.location=e.redirect},e.timeout)}else{window.location=e.redirect}}}i.setLoadingState("ready")};this.errorP=function(e){if(i.errorpopup){invokeGenericModal({message:'<div class="ccl-font-h2 ccl-border-bottom ccl-padding-s ccl-margin-sm ccl-align-c">Error'+'</div><div class="ccl-font-p ccl-align-c ccl-margin-m">Please try submitting/reloading form, if this problem persists please report this at <a href="mailto:help@codechef.com">help@codechef.com.</a></div>'+'<button type="submit" id="'+i.formId+"-reload-button"+'" class="ccl-margin-auto ccl-padding-m ccl-f-input">Reload</button>',closeCross:true,id:i.formId+"-error-popup",callback:function(){$("#"+i.formId+"-reload-button").click(function(){i.loadForm();$("#"+i.formId+"-error-popup").popup("hide")})}})}else{i.getFormElement().html('<div class="ccl-font-p ccl-align-c ccl-margin-m">Please try submitting/reloading form, if this problem persists please report this at <a href="mailto:help@codechef.com">help@codechef.com.</a></div>'+'<button type="submit" id="'+i.formId+"-reload-button"+'" class="ccl-margin-auto ccl-padding-m ccl-f-input">Reload</button>');$("#"+i.formId+"-reload-button").click(function(){i.loadForm()})}i.setLoadingState("ready")};this.changeCaptchaHTML=function(){var e=$(i.getFormElement().find(".captcha")[0]);e.addClass("ccl-margin-m ccl-clearfix ccl-su-position-rel");e.find("img").wrap('<div style="display: inline;" class="ccl-su-captcha-span ccl-align-l "></div>');e.find("#edit-captcha-response").addClass("ccl-f-placeholder ccl-f-input");if(e.find("#edit-captcha-response").parent().is("div")){e.find("#edit-captcha-response").unwrap();e.find("#edit-captcha-response").wrap('<div style="display: inline;" id="edit-captcha-response-wrapper" class="ccl-su-captcha-span"></div>');e.find("#edit-captcha-response-wrapper").before('<button id="captcha-reload" class="small-refresh-button fa fa-refresh"></button>');e.find("#captcha-reload").click(function(e){e.preventDefault();i.reloadCaptcha();return false});e.find("#edit-captcha-response").attr("description","1");e.find("#edit-captcha-response").attr("placeholder","Enter")}i.getFormElement().find(".captcha").find(".description").attr("id","captcha-response-description");i.getFormElement().find(".captcha").find("label").remove()};this.reloadCaptcha=function(){var e=i.getFormElement();var t=new Date;var r="/captcha/refresh/"+i.formId+"?"+t.getTime();e.find(".captcha").find("img").css("width","26px");e.find(".captcha").find("img").attr("src","/em/components/cceditor/images/loader.gif");i.cAjax({url:r,data:{},success:function(i){if(i.status==1){$(this).on();e.find(".captcha").find("img").attr("src",i.data.url).load(function(){$(this).css("width","80px");$(this).off()});e.find("input[name=captcha_sid]").val(i.data.sid);e.find("input[name=captcha_token]").val(i.data.token)}else{alert(i.message)}},dataType:"json"});return false};this.showForm=function(){if(i.isAjaxForm){i.setLoadingState("loading");i.loadForm()}else{console.log("here");i.changeCaptchaHTML();i.disableCopyPaste();i.alignRadioButtons();i.attachDescriptionElement();i.bindValidators();i.disableAutocomplete()}};this.showForm()};